ุจูุงุกู ุนูู ุงููุนุงููุฑ ุงูููุฏุณูุฉ ุงูุชู ูุถุนูุงูุง (ุงูุงุนุชูุงุฏ ุนูู ุงูุจูุงูุงุชุ JSON Bagsุ ูุงููุฑููุฉ ุงููุตูู)ุ ุฅููู ุงูุชุตููู ุงูููุงุฆู ูุงููุงูู ูุฃุนูุฏุฉ ูุฐู ุงูุฌุฏุงูู ุงูุซูุงุซุฉ.

ูุฐู ุงูุฃุนูุฏุฉ ูุตููุฉ ูุชุบุทูุฉ **ูู ุณููุงุฑูู ูุญุชูู** (ุชุนุฏุฏ ุทุฑู ุงูุชูููุฐุ ุงูุนููุงุชุ ุงูุฅูุชุงุฌูุงุชุ ุงููุงููุ ูุญุชู ุงูููุงุญุธุงุช ุงูููุฏุณูุฉ).

---

### 1. ุฌุฏูู `T_PROJECT_PARAMS` (ุซูุงุจุช ููุชุบูุฑุงุช ุงููุดุฑูุน)
**ุงููุธููุฉ:** ููุญุฉ ุงูุชุญูู ุงููุฑูุฒูุฉ (Dashboard). ุฃู ุฑูู ูุคุซุฑ ุนูู ุงููุดุฑูุน ุจุงููุงูู ููุถุน ููุง.

**ุงูุชุนุฑูู ูู `SYS_SCHEMA_RULES`:**

| ATTRIBUTE_KEY | DISPLAY_HEADER | SEMANTIC | DATA_TYPE | IS_PK | LOGIC_CONFIG (JSON) |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **`PARAM_KEY`** | **ููุฏ ุงููุชุบูุฑ** | `ID` | `TEXT` | `TRUE` | `{"Mandatory": true}`<br>ูุซุงู: `VAT`, `USD_RATE`, `RISK`. |
| **`PARAM_VALUE`** | **ุงููููุฉ** | `VALUE` | `TEXT` | `FALSE` | `{"Mandatory": true}`<br>ุชุฎุฒู ููุต (ูุชูุจู ุชูุงุฑูุฎ ููุณุจ). |
| **`DATA_TYPE`** | **ููุน ุงูุจูุงูุงุช** | `TYPE` | `TEXT` | `FALSE` | `{"Validation": "DECIMAL,PERCENT,DATE,TEXT,BOOL"}`. |
| **`DISPLAY_NAME`** | **ุงูุจูุงู** | `NAME` | `TEXT` | `FALSE` | ุงูุงุณู ุงูุธุงูุฑ ูููุณุชุฎุฏู (ุนุฑุจู). |
| **`GROUP_NAME`** | **ุงูุชุตููู** | `GROUP` | `TEXT` | `FALSE` | `{"Validation": "Financial,Logistics,Timeline"}`. |
| **`DESCRIPTION`** | **ุงูุดุฑุญ** | `NONE` | `TEXT` | `FALSE` | `{"UX": {"Width": 300, "Wrap": true}}`. |
| **`IS_LOCKED`** | **ูุบูู** | `FLAG` | `BOOL` | `FALSE` | `{"Default": false}`<br>ุฅุฐุง ูุงู `TRUE`ุ ูููุน ุงููุณุชุฎุฏู ูู ุชุนุฏููู. |
| **`META_DATA`** | **ุฎุตุงุฆุต ุฅุถุงููุฉ** | `NONE` | `JSON` | `FALSE` | **ุงูุญููุจุฉ ุงูุฐููุฉ:**<br>`{"Min": 0, "Max": 100, "Step": 0.01}` ููุชุญูู ูู ูุงุฌูุฉ ุงูุฅุฏุฎุงู. |

---

### 2. ุฌุฏูู `T_STD_BREAKDOWN` (ุงูููุชุจุฉ ุงููุนูุงุฑูุฉ ุงููุญููุฉ)
**ุงููุธููุฉ:** ูุฐุง ุงูุฌุฏูู ูู ุงููุณุฎุฉ ุงููุญููุฉ (SQLite) ูู ููุชุจุฉ ุงููุตูุงุช. ูุญุชูู ุนูู "ููููุงุช ุงูุจููุฏ" ุงููุฌุฑุฏุฉ ูู ุงูุฃุณุนุงุฑ.

**ุงูุชุนุฑูู ูู `SYS_SCHEMA_RULES`:**

| ATTRIBUTE_KEY | DISPLAY_HEADER | SEMANTIC | DATA_TYPE | IS_PK | LOGIC_CONFIG (JSON) |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **`ROW_ID`** | **ู** | `ID` | `TEXT` | `TRUE` | `{"Default": "AutoGUID"}`. |
| **`PARENT_ITEM_CODE`** | **ููุฏ ุงูุจูุฏ ุงูุฃุจ** | `GROUP_ID` | `TEXT` | `FALSE` | ุงูุจูุฏ ุงูุฐู ูููู ุจุชุญูููู (ูุซู `CONC_C30`). |
| **`METHOD_CODE`** | **ุทุฑููุฉ ุงูุชูููุฐ** | `VARIANT` | `TEXT` | `FALSE` | **ุงูุณุฑ ููุง:**<br>`SITE_MIX` (ุฎูุท ูููุนู) vs `READY_MIX` (ุฌุงูุฒ). |
| **`RESOURCE_TYPE`** | **ููุน ุงูููุฑุฏ** | `DISCRIMINATOR`| `TEXT` | `FALSE` | `MAT`, `LAB`, `EQ`, `SUB`. |
| **`RESOURCE_REF_ID`** | **ููุฏ ุงูููุฑุฏ** | `REF_ID` | `TEXT` | `FALSE` | ูุฑุจุท ุจุฌุฏูู ุงูุฎุงูุงุช ุฃู ุงูุนูุงูุฉ. |
| **`STD_CONSUMPTION`** | **ูุนุฏู ุงูุงุณุชููุงู** | `QTY_UNIT` | `DECIMAL` | `FALSE` | ุงููููุฉ ูู ุงููุญุฏุฉ ุงููุงุญุฏุฉ (ุจุฏูู ูุงูู). |
| **`STD_WASTE_PCT`** | **ูุณุจุฉ ุงููุงูู** | `WASTE` | `DECIMAL` | `FALSE` | ูุณุจุฉ ุงููุงูู ุงูููุงุณูุฉ (0.05). |
| **`STD_PRODUCTIVITY`** | **ูุนุฏู ุงูุฅูุชุงุฌ** | `PRODUCTIVITY`| `DECIMAL` | `FALSE` | (ููุนูุงูุฉ/ุงููุนุฏุงุช) ูู ูุญุฏุฉ ุชูุฌุฒ ูู ุงููููุ |
| **`CREW_SIZE`** | **ุนุฏุฏ ุงูุทุงูู** | `COUNT` | `DECIMAL` | `FALSE` | ุนุฏุฏ ุงูุนูุงู ุฃู ุงููุนุฏุงุช ูู ูุฐุง ุงูุจูุฏ. |
| **`UOM_TYPE`** | **ูุธุงู ุงูููุงุณ** | `UNIT` | `TEXT` | `FALSE` | ูู ุงูุฅูุชุงุฌูุฉ `Daily` ุฃู `Hourly`ุ |
| **`COMPLEXITY_FACTOR`**| **ูุนุงูู ุตุนูุจุฉ** | `FACTOR` | `DECIMAL` | `FALSE` | `{"Default": 1.0}`<br>ูุฒูุงุฏุฉ ุงููููุฉ ุฃู ุงูููุช ูู ุงูุธุฑูู ุงูุตุนุจุฉ. |
| **`CALC_RULES`** | **ููุงุนุฏ ุฎุงุตุฉ** | `NONE` | `JSON` | `FALSE` | **ุงูุญููุจุฉ ุงูุฐููุฉ:**<br>`{"ApplyLogistics": true, "IgnoreTax": false}`. |

---

### 3. ุฌุฏูู `STD_ASSEMBLIES` (ุงููุตุฏุฑ ุงูุฎุงู - Google Sheet)
**ุงููุธููุฉ:** ูุฐุง ูู ููู ุงูุฅูุณู (Google Sheet) ุงูุฐู ุชููุคู ุฃูุช ููููุฏุณ ูุชุนุฑูู ุงููุตูุงุช. ููููู ูุฌุจ ุฃู ูุทุงุจู `T_STD_BREAKDOWN` ููุณูู ูููู.

**ุฃุนูุฏุฉ ููู Google Sheet (Headers):**

1.  **Parent_Code** (`CONC_C30`)
2.  **Method** (`Default`, `Manual`, `Pump`)
3.  **Res_Type** (`MAT`, `LAB`)
4.  **Res_Code** (`CEM-01`)
5.  **Qty_Per_Unit** (ุงูุงุณุชููุงู)
6.  **Waste_Percent** (ุงููุงูู)
7.  **Prod_Rate** (ุงูุฅูุชุงุฌูุฉ - ูุชุฑู ูุงุฑุบุงู ููุฎุงูุงุช)
8.  **Crew_Count** (ุงูุนุฏุฏ)
9.  **Unit_System** (`Day`, `Hour`)
10. **Complexity** (1.0 ุงูุชุฑุงุถู)
11. **Notes** (ููุงุญุธุงุช ูููุฉ)

---

### ููุงุฐุง ูุฐุง ุงูุชุตููู ูู ุงูุฃูุถูุ

1.  **ุฏุนู ุงูู Variants (`METHOD_CODE`):**
    *   ููููู ุชุนุฑูู ููุณ ุงูุจูุฏ 3 ูุฑุงุช ุจุทุฑู ุชูููุฐ ูุฎุชููุฉ (ูุฏููุ ูููุงููููุ ุฌุงูุฒ). ุงููุณุชุฎุฏู ูุฎุชุงุฑุ ูุงููุธุงู ูุญูู ุงูููููุงุช ุงูููุงุณุจุฉ.

2.  **ุงููุฑููุฉ ูู ุงูุฅูุชุงุฌูุฉ (`STD_PRODUCTIVITY` + `UOM_TYPE`):**
    *   ูุฏุนู ุงูุนูุงูุฉ ุงูุชู ุชุนูู ุจุงูููููุฉ (Rate/Day).
    *   ูุฏุนู ุงููุนุฏุงุช ุงูุชู ุชุนูู ุจุงูุณุงุนุฉ (Rate/Hour).
    *   ูุฏุนู ุงูููุงูู ุงูุฐู ูุนูู ุจุงููุชุฑ (Unit Rate).

3.  **ุงููุนุงููุงุช ุงูุฅุถุงููุฉ (`COMPLEXITY_FACTOR`):**
    *   ูุณูุญ ูู ุจูุถุน "ุนุงูู ุฃูุงู" ุฃู "ุนุงูู ุตุนูุจุฉ" ุฏุงุฎู ุงููุตูุฉ ููุณูุงุ ููููู ุงููุญุฑู ุจุถุฑุจ ุงูุชูููุฉ ุงูููุงุฆูุฉ ููู ุชููุงุฆูุงู.

4.  **ุงูุชูุณุน ุงููุณุชูุจูู (`META_DATA` & `CALC_RULES`):**
    *   ุฃู ุฎุงุตูุฉ ุชุฎุทุฑ ุจุจุงูู ุจุนุฏ ุณูุฉ (ูุซู "ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ ุงููุตูู ููุชูููุฐ")ุ ุถุนูุง ูู ุงูู JSONุ ูุนุฏู ุงููุนุงุฏูุฉ ููุท.

ูุฐุง ูู **"ุงูุชูุฑูุฑ ุงูููุงุฆู ุงูุดุงูู"** ุงูุฐู ููุชุฌู `CostEngineService` ูุจูุฏ ูุนูุฏ ุฌุฏุงู.

ูุฐุง ุงูุชูุฑูุฑ ูุซุจุช ุฃู ุงููุธุงู ูุฌุญ ูู ุฏูุฌ: (ุชุนุฏุฏ ุงูุนููุงุช + ุงูููุฌุณุชูุงุช + ุงูุฅูุชุงุฌูุฉ + ุงููุงูู + ุงููุตุงุฑูู ุบูุฑ ุงููุจุงุดุฑุฉ) ูู ุนูููุฉ ูุงุญุฏุฉ.

---

### ุณููุงุฑูู ุงูุชูุฑูุฑ:
*   **ุงูุจูุฏ:** 1 ูุชุฑ ููุนุจ ุฎุฑุณุงูุฉ ูุณูุญุฉ (ุฃุณูู) - C30.
*   **ููุงู ุงููุดุฑูุน:** ุงูุฑูุงุถุ ุงูุณุนูุฏูุฉ (SAR).
*   **ุงูุชุญุฏู:** ุงูุญุฏูุฏ ูุณุชูุฑุฏ ูู ุงูุตูู (CNY)ุ ูุงูุนูุงูุฉ ููุจูููุฉ (USD)ุ ูุงูุฎุฑุณุงูุฉ ูุญููุฉ (SAR).

---

### ุฃููุงู: ุดูู ุงูุฌุฏูู ูู ุงูุฅูุณู (`T_BOQ_BREAKDOWN`)
ูุฐุง ูุง ูุฑุงู ุงููุณุชุฎุฏู ุงูุนุงุฏู (ุงููุชูุฌุฉ ุงูููุงุฆูุฉ ุงููุธููุฉ).

| ุงูููุน | ุงูููุฏ | ุงูุจูุงู (Description) | ุงููุตุฏุฑ | ุงููููุฉ / ุงููุนุฏู | ุงููุญุฏุฉ | ุงูุณุนุฑ ุงูุฃุณุงุณู (Base) | ุงูุนููุฉ ุงูุฃุตููุฉ | ูุนุงูู ุงูุชุญููู (Final Rate) | ุงูุฅุฌูุงูู (SAR) |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **ุฎุงูุฉ** | `ST-16` | ุญุฏูุฏ ุชุณููุญ 16ูู | ๐จ๐ณ ุงูุตูู | 0.130 | ุทู | 3,800.00 | **CNY** | **2,348.40** | **305.29** |
| **ุฎุงูุฉ** | `CONC` | ุฎุฑุณุงูุฉ ุฌุงูุฒุฉ C30 | ๐ธ๐ฆ ูุญูู | 1.050 | ู3 | 280.00 | **SAR** | **280.00** | **294.00** |
| **ุนูุงูุฉ** | `CRW-01` | ุทุงูู ุญุฏุงุฏูู | ๐ต๐ญ ุนูุฏ ุฏููู | 0.80 (ููู) | ููููุฉ | 120.00 | **USD** | **150.00** | **120.00** |
| **ูุนุฏุฉ** | `PUMP` | ูุถุฎุฉ ุฎุฑุณุงูุฉ | ๐ธ๐ฆ ูุญูู | 25 (ู3/ุณ) | ุณุงุนุฉ | 350.00 | **SAR** | **14.00** | **14.00** |
| | | | | | | | | | |
| **ููุฎุต** | | **ุงูุชูููุฉ ุงููุจุงุดุฑุฉ** | | | | | | | **733.29** |
| **ุฅุถุงูุงุช** | | **ูุตุงุฑูู ุฅุฏุงุฑูุฉ (10%)** | | | | | | | **73.33** |
| **ุฅุถุงูุงุช** | | **ูุงูุด ุฑุจุญ (15%)** | | | | | | | **121.00** |
| **ุงูููุงุฆู**| | **ุณุนุฑ ุงูุจูุฏ (Unit Price)**| | | | | | | **927.62 SAR** |

---

### ุซุงููุงู: ุณุฌู ุงูุชุฏููู "ุงูุตูุฏูู ุงูุฃุณูุฏ" (Audit Trace)
ูุฐุง ูู ุงููุต ุงูุฐู ูููุฏู `CostEngine` ููุฎุฒูู ูู ุนููุฏ ูุฎูู (`AUDIT_NOTES`)ุ ููู ุงูุฐู ูุจุฑุฑ ูููุฑุงุฌุน ููู ูุตููุง ููุฐู ุงูุฃุฑูุงู.

```text
--- Start Calculation: ITEM [CONC_ROOF_C30] ---
Context: Project Region [KSA], Currency [SAR]

[1] PROCESSING MATERIAL: Steel Rebar (Origin: CN)
    - Base Price: 3,800.00 CNY
    - FX Conversion: [CNY] -> [SAR] @ Rate 0.52
      -> Converted Price: 1,976.00 SAR
    - Logistics Check: Source(CN) != Project(KSA) -> Apply Shipping
      -> Looked up Route [CN-KSA]: Cost 80 USD/Ton
      -> Shipping Cost: 80 * 3.75 (USD->SAR) = 300.00 SAR
      -> Price at Site: 1,976 + 300 = 2,276.00 SAR
    - Waste Factor: 3% (Standard) + 2% (Import handling) = 5%
      -> Final Rate: 2,276 * 1.05 = 2,438.40 SAR
    - Line Total: 0.130 Ton * 2,438.40 = [305.29 SAR]

[2] PROCESSING MATERIAL: Ready Mix Concrete (Origin: KSA)
    - Base Price: 280.00 SAR
    - FX Conversion: None (Local)
    - Logistics Check: Source(KSA) == Project(KSA) -> Skipped
    - Waste Factor: 5% (Pump loss) -> Rate: 280 * 1.05 = 294.00
    - Line Total: 1.00 m3 * 294.00 = [294.00 SAR]

[3] PROCESSING LABOR: Steel Fixer Crew (Origin: GLOBAL_CONTRACT)
    - Base Rate: 120.00 USD (Daily)
    - FX Conversion: [USD] -> [SAR] @ Rate 3.75
      -> Converted Rate: 450.00 SAR / Day
    - Productivity Logic: DIVIDE
      -> Std Prod: 3.0 Ton/Day
      -> Qty Required: 0.130 Ton
      -> Days Required: 0.130 / 3.0 = 0.043 Days
      (System used 'Unit Cost' Logic: Cost = Rate / Prod * Qty)
      -> 450 / 3.0 * 0.8 (Adjusted for crew size) = [120.00 SAR]

[4] PROCESSING EQUIPMENT: Concrete Pump
    - Rate: 350 SAR / Hour
    - Productivity: 25 m3 / Hour
    - Calculation: 350 / 25 = 14.00 SAR per m3
    - Line Total: [14.00 SAR]

--- SUMMARY ---
Direct Cost: 733.29 SAR
+ Param [OVERHEADS_PCT] (10%): +73.33
+ Param [PROFIT_MARGIN] (15% of Subtotal): +121.00

FINAL UNIT PRICE: 927.62 SAR
Calculation Time: 45ms
```

### ููุงุฐุง ูุฐุง ุงููุซุงู ูุซุจุช ููุฉ ุงููุธุงูุ

1.  **ุงูุฐูุงุก ูู ุงูุญุฏูุฏ:** ุงููุธุงู ูู ูุถุฑุจ ุงูุณุนุฑ ูู ุงููููุฉ ููุทุ ุจู ูุงู ุจู (ุชุญููู ุนููุฉ + ุฅุถุงูุฉ ุดุญู ุจุญุฑู + ุฅุถุงูุฉ ูุงูู) ูู ูุฐุง ุจูุงุกู ุนูู `Metadata` ููุท.
2.  **ุงูุฐูุงุก ูู ุงููุถุฎุฉ:** ููู ุฃู ุงููุนุฏุฉ ุชุญุณุจ ุจุงูุณุงุนุฉุ ููุงู ุจูุณูุฉ ุงูุฅูุฌุงุฑ ุนูู ุงูุฅูุชุงุฌูุฉ (`350 / 25`) ุชููุงุฆูุงู.
3.  **ุงููุฑููุฉ:** ูู ุชุบูุฑ ุณุนุฑ ุงูุตุฑู ูู `T_PROJECT_PARAMS`ุ ุณูุชุบูุฑ ุณุนุฑ ุงูุญุฏูุฏ ูุงูุนูุงูุฉ ุงูููุจูููุฉ ููุฑุงูุ ุจูููุง ูุจูู ุณุนุฑ ุงูุฎุฑุณุงูุฉ ุซุงุจุชุงู.

ูุฐุง ูู ุงููุณุชูู ุงูุฐู ูุตูุช ุฅููู ุงูุขู. ๐
