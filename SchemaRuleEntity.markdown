إليك **الجدول الإرشادي المرجعي (Reference Guide)** لجدول تعريف الأعمدة **`SYS_SCHEMA_RULES`** (الذي يمثله الكلاس `SchemaRuleEntity`).

هذا الجدول هو "الكتالوج" الذي ستستخدمه عند تعبئة بيانات الأعمدة في Google Sheets، لضمان أن يفهم "المحرك" (Engine) وظيفة كل عمود وكيف يعرضه.

---

### أولاً: الأعمدة الأساسية (Physical Columns)
هذه الأعمدة صريحة في قاعدة البيانات، وتتحكم في الهوية والمنطق الأساسي.

| اسم العمود (Column) | النوع | الوصف والدور | القيم المسموحة / أمثلة |
| :--- | :--- | :--- | :--- |
| **`ENTITY_KEY`** | `String` (FK) | **اسم الجدول.**<br>يربط هذا العمود بجدوله الأصلي في `SYS_DEFINITIONS`. | `T_MATERIALS`<br>`T_LABOR` |
| **`ATTRIBUTE_KEY`** | `String` | **اسم العمود البرمجي.**<br>اسم العمود في قاعدة البيانات (SQL). يجب أن يكون إنجليزي بدون مسافات. | `UNIT_PRICE`<br>`ITEM_NAME`<br>`QTY_AVAIL` |
| **`ORDINAL_POS`** | `Int` | **الترتيب.**<br>ترتيب ظهور العمود في الجدول (من اليسار لليمين أو العكس). | `1`, `2`, `10` |
| **`SEMANTIC_ROLE`** | `String` | **الدور الدلالي (هام جداً).**<br>يخبر محرك التسعير بوظيفة هذا العمود. | **`PRICE`** (للسعر)<br>**`QTY`** (للكمية)<br>**`TOTAL`** (للإجمالي)<br>**`UNIT`** (وحدة القياس)<br>**`NAME`** (اسم البند)<br>**`WASTE`** (نسبة الهالك)<br>**`NONE`** (لا دور محدد) |
| **`DATA_TYPE`** | `String` | **نوع البيانات (SQL).**<br>لتحديد نوع التخزين في قاعدة البيانات. | **`TEXT`**<br>**`INT`**<br>**`DECIMAL`**<br>**`BOOL`**<br>**`DATE`** |
| **`IS_PK`** | `Bool` | **مفتاح أساسي.**<br>هل هذا العمود يميز الصف بشكل فريد؟ (هام للتحديثات). | `TRUE` / `FALSE` |

---

### ثانياً: إعدادات العرض (UX_CONFIG JSON)
مفاتيح توضع داخل عمود `UX_CONFIG` للتحكم في شكل العمود داخل Excel.

| المفتاح (JSON Key) | الوصف | القيم / أمثلة |
| :--- | :--- | :--- |
| **`"Header"`** | **العنوان الظاهر.**<br>اسم العمود كما يراه المستخدم (يدعم العربية). | `"سعر الوحدة"`, `"الكمية"` |
| **`"Width"`** | **عرض العمود.**<br>عرض العمود بالبكسل. | `100`, `150`, `60` |
| **`"Align"`** | **المحاذاة.**<br>اتجاه النص داخل الخلية. | `"Center"`, `"Right"`, `"Left"` |
| **`"Format"`** | **تنسيق الأرقام.**<br>كود تنسيق الإكسل (Excel Format String). | `"#,##0.00"` (عملة)<br>`"0%"` (نسبة)<br>`"dd/mm/yyyy"` (تاريخ) |
| **`"Visible"`** | **الظهور.**<br>هل العمود ظاهر أم مخفي؟ | `true` (افتراضي), `false` |
| **`"Wrap"`** | **التفاف النص.**<br>هل ينزل النص لسطر جديد إذا طال؟ | `true`, `false` |
| **`"Tooltip"`** | **تلميح.**<br>رسالة تظهر عند وقوف الماوس على رأس العمود. | `"السعر شامل الضريبة"` |

---

### ثالثاً: إعدادات المنطق (LOGIC_CONFIG JSON)
مفاتيح توضع داخل عمود `LOGIC_CONFIG` للتحكم في السلوك والحسابات.

| المفتاح (JSON Key) | الوصف | القيم / أمثلة |
| :--- | :--- | :--- |
| **`"Virtual"`** | **عمود افتراضي.**<br>إذا كان `true`، فهذا العمود غير موجود في الداتابيز، بل يتم حسابه لحظياً. | `true`, `false` |
| **`"Formula"`** | **معادلة إكسل.**<br>المعادلة التي ستكتب داخل الخلية (يجب أن تبدأ بـ `=`). | `=[@Qty]*[@Price]`<br>`=IF([@Val]>0, "Yes", "No")` |
| **`"Default"`** | **قيمة افتراضية.**<br>تستخدم إذا كانت القيمة في المصدر فارغة. | `0`, `"N/A"`, `1` |
| **`"Mandatory"`** | **إجباري.**<br>هل يجب أن يحتوي العمود على قيمة؟ | `true`, `false` |
| **`"License"`** | **حجب الباقة.**<br>لن يظهر العمود إلا لهذه الباقة أو أعلى. | `"Free"`, `"Premium"`, `"Enterprise"` |

---

### أمثلة عملية (Copy-Paste Ready)

#### 1. عمود "سعر الوحدة" (ذكي ومرتبط بالباقة)
عمود يحتوي على سعر، يُنسق كعملة، إجباري، ولا يظهر إلا للباقة المدفوعة.

*   **ATTRIBUTE_KEY:** `UNIT_PRICE`
*   **SEMANTIC_ROLE:** `PRICE`
*   **DATA_TYPE:** `DECIMAL`
*   **UX_CONFIG:**
    ```json
    { "Header": "سعر الوحدة", "Width": 120, "Format": "#,##0.00", "Align": "Center" }
    ```
*   **LOGIC_CONFIG:**
    ```json
    { "Mandatory": true, "Default": 0, "License": "Premium" }
    ```

#### 2. عمود "الإجمالي" (محسوب / Virtual)
عمود لا يأتي من الداتابيز، بل يحسبه الإكسل (الكمية × السعر).

*   **ATTRIBUTE_KEY:** `TOTAL_COST`
*   **SEMANTIC_ROLE:** `TOTAL`
*   **DATA_TYPE:** (اتركه فارغاً أو TEXT)
*   **UX_CONFIG:**
    ```json
    { "Header": "الإجمالي", "Width": 150, "Format": "#,##0.00 $", "Color": "#E0E0E0" }
    ```
*   **LOGIC_CONFIG:**
    ```json
    { "Virtual": true, "Formula": "=[@UNIT_PRICE]*[@QTY]" }
    ```

#### 3. عمود "اسم المورد" (نصي عادي)
*   **ATTRIBUTE_KEY:** `VENDOR_NAME`
*   **SEMANTIC_ROLE:** `NAME`
*   **DATA_TYPE:** `TEXT`
*   **UX_CONFIG:**
    ```json
    { "Header": "المورد", "Width": 200, "Align": "Right", "Wrap": true }
    ```
*   **LOGIC_CONFIG:**
    ```json
    { "Default": "مورد عام" }
    ```
