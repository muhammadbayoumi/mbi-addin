هذا الجدول المرجعي (Master Registry) هو الذي سيتم وضعه داخل قاعدة البيانات في جدول `SYS_DEFINITIONS`. هو الخريطة التي تجعل النظام "يفهم" طبيعة كل جدول، وكيف يعرضه للمستخدم، وما هو الدور المنطقي له.

لقد قمت بتقسيم الجداول إلى **3 فئات رئيسية** (Metadata, Lookup, Operational).

### الجدول المرجعي العام لجداول النظام (System Tables Master Registry)

| اسم الجدول (ENTITY_KEY) | الفئة (Category) | نوع البيانات (EntityType) | طريقة العرض (ViewMode) | الوصف والدور المنطقي | المصدر (Source) |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **SYS_DEFINITIONS** | **Metadata** | `REF` | `Table` | تعريف هوية الجداول (الجداول التي أرسلتها لي). | Local DB |
| **SYS_SCHEMA_RULES** | **Metadata** | `REF` | `Table` | تعريف أعمدة النظام وقواعد التحقق (الدماغ). | Local DB |
| **SYS_DATA_SOURCES** | **Metadata** | `REF` | `Table` | الربط بمصادر البيانات الخارجية (رابط الإكسل/السحابة). | Local DB |
| **SYS_DATA_MODEL** | **Metadata** | `REF` | `Table` | تعريف العلاقات الهرمية ومنطق الحساب (Engine). | Local DB |
| **SYS_DATA_MAP** | **Metadata** | `REF` | `Table` | خريطة تحويل البيانات من المصادر الخارجية للنظام. | Local DB |
| **SYS_CURRENCIES** | **Lookup** | `COST` | `Table` | العملات المدعومة وأسعار الصرف الحالية. | System Table |
| **SYS_UNIT_TYPES** | **Lookup** | `PERF` | `Table` | وحدات القياس (م، م2، م3، طن) ومعاملات التحويل. | System Table |
| **SYS_REGIONS** | **Lookup** | `REF` | `Table` | المناطق الجغرافية للتحكم في الضرائب واللوجستيات. | System Table |
| **T_PROJECT_PARAMS** | **Logic** | `REF` | **`Form`** | ثوابت المشروع (الضرائب، الهوامش، سعر الصرف الثابت). | User Input |
| **T_STD_BREAKDOWN** | **Template** | `COMP` | **`Breakdown`** | مكتبة "وصفات" البنود القياسية (بدون أسعار). | Google Sheet |
| **T_BOQ_BREAKDOWN** | **Operational**| `COMP` | **`Breakdown`** | جدول الكميات الفعلي للمشروع (النتيجة النهائية). | Dynamic |

---

### تفاصيل فئات الجداول (للمبرمج والمحرك):

#### 1. فئة الميتا-داتا (Metadata Tables) - "النظام يعرف نفسه"
هذه الجداول الـ 5 الأولى التي راجعناها معاً.
*   **الوظيفة:** لا تحتوي على بيانات مشاريع، بل تحتوي على "وصف" لكيفية عمل النظام.
*   **التعديل:** يتم تعديلها فقط من قبل المطور أو الأدمن المتقدم.

#### 2. فئة الجداول المرجعية (Reference/Lookup Tables) - "قاموس النظام"
تشمل `SYS_CURRENCIES`, `SYS_UNIT_TYPES`.
*   **الوظيفة:** توحيد المفاهيم. بدلاً من أن يكتب مستخدم "متر" ومستخدم آخر "م"، يختار الجميع من هذا الجدول.
*   **الديناميكية:** يمكن إضافة وحدة قياس جديدة هنا، وسيتعرف عليها النظام في كل مكان فوراً.

#### 3. فئة جداول المنطق والقوالب (Logic & Templates) - "المكتبة الهندسية"
تشمل `T_PROJECT_PARAMS` و `T_STD_BREAKDOWN`.
*   **الوظيفة:** تخزين المعايير الهندسية.
*   **الميزة:** `T_STD_BREAKDOWN` هو جدول هرمي (Parent/Child) يستخدم الـ `DataModel` لربط الموارد بالبنود.

#### 4. فئة الجداول التشغيلية (Operational Tables) - "مخرجات المشاريع"
تشمل `T_BOQ_BREAKDOWN`.
*   **الوظيفة:** هي الحاوية النهائية التي تجمع البيانات من المراجع (Lookups) وتطبق عليها الأسعار من المصادر (Sources) بناءً على القواعد (Rules).

---

### كيف تستخدم هذا الجدول في الكود (C#)؟

عند تحميل النظام، يمكنك إنشاء `List<TableDefinitionEntity>` تحتوي على هذه البيانات. عندما يطلب المستخدم فتح جدول "وحدات القياس"، يقوم النظام بالآتي:

1.  يبحث في الجدول المرجعي عن `SYS_UNIT_TYPES`.
2.  يجد أن الـ `ViewMode` هو `Table`.
3.  يقرأ الأعمدة الخاصة به من `SYS_SCHEMA_RULES`.
4.  يبني واجهة إكسل (Sheet) تحتوي على تلك الأعمدة فوراً.

**هل تريد مني الآن هيكلة "أعمدة" جداول المراجع (العملات والوحدات) بنفس الأسلوب الاحترافي الذي فعلناه لجداول التحليل؟**
